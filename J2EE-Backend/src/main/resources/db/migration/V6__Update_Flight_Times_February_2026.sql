-- =================================================================
-- FLYWAY MIGRATION V6: Update Flight Times for February 2026
-- Description: Update flight dates to be current with February 2026
-- Author: System
-- Date: 2026-02-13
-- =================================================================

-- Update existing flights to have dates around current time (February 2026)
-- Set flights to dates from Feb 13 to Feb 28, 2026

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-13',
    giodi = '08:00:00',
    ngayden = '2026-02-13',
    gioden = '10:05:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 1;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-13',
    giodi = '10:30:00',
    ngayden = '2026-02-13',
    gioden = '12:35:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 2;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-13',
    giodi = '15:00:00',
    ngayden = '2026-02-13',
    gioden = '16:15:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 3;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-14',
    giodi = '11:00:00',
    ngayden = '2026-02-14',
    gioden = '13:05:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 4;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-14',
    giodi = '09:00:00',
    ngayden = '2026-02-14',
    gioden = '11:00:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 5;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-14',
    giodi = '14:00:00',
    ngayden = '2026-02-14',
    gioden = '15:15:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 6;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-15',
    giodi = '06:30:00',
    ngayden = '2026-02-15',
    gioden = '08:35:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 7;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-15',
    giodi = '09:15:00',
    ngayden = '2026-02-15',
    gioden = '11:20:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 8;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-15',
    giodi = '14:45:00',
    ngayden = '2026-02-15',
    gioden = '16:50:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 9;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-16',
    giodi = '07:00:00',
    ngayden = '2026-02-16',
    gioden = '09:05:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 10;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-16',
    giodi = '11:30:00',
    ngayden = '2026-02-16',
    gioden = '13:35:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 11;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-17',
    giodi = '16:15:00',
    ngayden = '2026-02-17',
    gioden = '18:20:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 12;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-17',
    giodi = '08:45:00',
    ngayden = '2026-02-17',
    gioden = '10:50:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 13;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-18',
    giodi = '13:20:00',
    ngayden = '2026-02-18',
    gioden = '15:25:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 14;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-18',
    giodi = '06:00:00',
    ngayden = '2026-02-18',
    gioden = '08:05:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 15;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-19',
    giodi = '09:30:00',
    ngayden = '2026-02-19',
    gioden = '11:35:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 16;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-19',
    giodi = '14:00:00',
    ngayden = '2026-02-19',
    gioden = '15:15:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 17;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-20',
    giodi = '10:00:00',
    ngayden = '2026-02-20',
    gioden = '12:05:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 18;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-20',
    giodi = '07:15:00',
    ngayden = '2026-02-20',
    gioden = '09:20:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 19;

UPDATE chitietchuyenbay SET
    ngaydi = '2026-02-21',
    giodi = '15:30:00',
    ngayden = '2026-02-21',
    gioden = '16:45:00',
    trangthai = 'Đang mở bán',
    thoigianden_thucte = NULL,
    thoigiandi_thucte = NULL,
    lydoDelay = NULL
WHERE machuyenbay = 20;

-- Add some more flights for February
INSERT INTO chitietchuyenbay (machuyenbay, matuyenbay, mamaybay, sohieuchuyenbay, ngaydi, giodi, ngayden, gioden, trangthai, da_xoa, deleted_at) VALUES
(21, 1, 1, 'VN270', '2026-02-13', '12:00:00', '2026-02-13', '14:05:00', 'Đang mở bán', 0, NULL),
(22, 1, 2, 'VJ140', '2026-02-13', '16:30:00', '2026-02-13', '18:35:00', 'Đang mở bán', 0, NULL),
(23, 3, 3, 'VN720', '2026-02-14', '08:00:00', '2026-02-14', '09:15:00', 'Đang mở bán', 0, NULL),
(24, 2, 1, 'VN261', '2026-02-14', '14:30:00', '2026-02-14', '16:35:00', 'Đang mở bán', 0, NULL),
(25, 1, 3, 'VN262', '2026-02-15', '17:00:00', '2026-02-15', '19:05:00', 'Đang mở bán', 0, NULL),
(26, 3, 2, 'VN715', '2026-02-15', '10:30:00', '2026-02-15', '11:45:00', 'Đang mở bán', 0, NULL),
(27, 1, 1, 'VN263', '2026-02-16', '12:30:00', '2026-02-16', '14:35:00', 'Đang mở bán', 0, NULL),
(28, 2, 3, 'VN243', '2026-02-16', '15:45:00', '2026-02-16', '16:50:00', 'Đang mở bán', 0, NULL),
(29, 1, 3, 'VN264', '2026-02-17', '18:00:00', '2026-02-17', '20:05:00', 'Đang mở bán', 0, NULL),
(30, 3, 2, 'VN716', '2026-02-17', '09:00:00', '2026-02-17', '10:15:00', 'Đang mở bán', 0, NULL);

-- Add price schedules for new flights
INSERT INTO giachuyenbay (magia, matuyenbay, mahangve, giave, soluong_phanbo, soluong_daban, ngayapdungtu, ngayapdungden, da_xoa, deleted_at)
SELECT
    (SELECT COALESCE(MAX(magia), 0) FROM giachuyenbay) + ROW_NUMBER() OVER (ORDER BY ctb.machuyenbay, hv.mahangve) AS magia,
    ctb.matuyenbay,
    hv.mahangve,
    CASE hv.mahangve
        WHEN 1 THEN 1200000
        WHEN 2 THEN 1000000
        WHEN 3 THEN 2000000
        WHEN 4 THEN 4000000
        WHEN 5 THEN 8000000
        ELSE 1000000
    END AS giave,
    180 AS soluong_phanbo,
    0 AS soluong_daban,
    '2026-02-01' AS ngayapdungtu,
    '2026-03-31' AS ngayapdungden,
    0 AS da_xoa,
    NULL AS deleted_at
FROM chitietchuyenbay ctb
CROSS JOIN hangve hv
WHERE ctb.machuyenbay BETWEEN 21 AND 30
AND hv.mahangve <= 3;
